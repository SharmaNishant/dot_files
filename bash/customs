#!/bin/bash
# Shell customizations for both bash and zsh. Setup aliases, functions, and prompts
#
# Author: Nishant Sharma <'nishants1994' at gmail>

if [[ "$0" = "${BASH_SOURCE[0]}" ]]; then
    echo "This script should be sourced, not executed directly"
    exit 1
fi

# Common configuration
export HISTSIZE=99999
export EDITOR="nvim"



# Detect shell and configure shell-specific settings
if [ -n "$ZSH_VERSION" ]; then
    # ZSH configuration
    # History settings
    export SAVEHIST=99999
    setopt HIST_IGNORE_ALL_DUPS
    setopt APPEND_HISTORY
    setopt SHARE_HISTORY
    
    # Prompt configuration
    autoload -Uz vcs_info
    precmd() { vcs_info }
    zstyle ':vcs_info:git:*' formats ' (%b)'
    setopt PROMPT_SUBST
    export PS1='%F{cyan}%~%f%F{yellow}${vcs_info_msg_0_}%f %F{green}➜%f '
    export RPS1='%F{magenta}[%D{%H:%M:%S}]%f'
    
elif [ -n "$BASH_VERSION" ]; then
    # BASH configuration
    # History settings
    export HISTCONTROL=erasedups
    export HISTFILESIZE=99999
    shopt -s histappend
    
    # Prompt configuration
    git_branch() {
        git branch 2>/dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
    }
    
    get_time() {
        date +"%H:%M:%S"
    }
    
    export PS1='\[\033[36m\]\w\[\033[33m\]$(git_branch)\[\033[32m\] ➜\[\033[0m\] '
    export PROMPT_COMMAND='echo -ne "\033]0;$(get_time)\007"'
    
else
    echo "Unsupported shell"
fi

print_horizontal_line () {
    printf '%*s\n' "${COLUMNS:-$(tput cols)}" '' | tr ' ' -
}


# enable colors
if command -v dircolors >/dev/null 2>&1; then
  eval "$(dircolors -b)"
  # ZSH-specific completion colors
  if [ -n "$ZSH_VERSION" ]; then
    zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
  fi
else
  export CLICOLOR=1
  # ZSH-specific completion colors
  if [ -n "$ZSH_VERSION" ]; then
    zstyle ':completion:*:default' list-colors ''
  fi
fi

# force ls to always use color and type indicators
alias ls='ls -hF --color=auto'

# make the dir command work kinda like in windows (long format)
alias dir='ls --color=auto --format=long'

# make grep highlight results using color
#export GREP_OPTIONS='--color=auto'

# Add some colour to LESS/MAN pages
export LESS_TERMCAP_mb=$'\E[01;31m'
export LESS_TERMCAP_md=$'\E[01;33m'
export LESS_TERMCAP_me=$'\E[0m'
export LESS_TERMCAP_se=$'\E[0m'
export LESS_TERMCAP_so=$'\E[01;42;30m'
export LESS_TERMCAP_ue=$'\E[0m'
export LESS_TERMCAP_us=$'\E[01;36m'

######### ONE TIME GIT SETTINGS ###############


function setup_git_config() {

git config --global core.editor nvim

git config --global diff.tool meld
git config --global difftool.prompt false
git config --global difftool.meld trustExitCode true

git config --global merge.tool meld
git config --global mergetool.prompt false
git config --global mergetool.meld trustExitCode true

git config --global user.name "Nishant Sharma"

git config --global mergetool.keepBackup false
git config --global pull.ff only

git config --global difftool.nvimdiff.cmd 'nvim -d -u ~/.vimrc "$LOCAL" "$REMOTE"'
git config --global mergetool.nvimdiff.cmd "nvim -d $BASE $LOCAL $REMOTE $MERGED -c '$wincmd w' -c 'wincmd J'"

git config --global branch.sort -committerdate

git config --global core.fsmonitor true

git config --global alias.fpush push --force-with-lease

echo "please config which email you want next"
echo "git config --global user.email "

}
